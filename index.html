<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumanchee Expense Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Import Professional Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap');

        /* Default (Light) Theme Variables */
        :root {
            --primary-color: #0d9488; /* Teal - Default Accent */
            --secondary-color: #fcd34d; /* Amber */
            --expense-color: #ef4444; /* Red */
            --income-color: #15976c; /* Green */
            --background-color: #f4f6f9; /* Light Gray Background */
            --surface-color: #ffffff; /* White Card/Box */
            --text-color: #1f2937; /* Dark Gray Text */
            --text-light: #6b7280;
            --shadow-light: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        /* Dark Theme Variables */
        body.dark-mode {
            --primary-color: #36a193; /* Lighter Teal */
            --secondary-color: #fde047; /* Bright Yellow */
            --expense-color: #f87171; /* Lighter Red */
            --income-color: #1d7a58; /* Lighter Green */
            --background-color: #111827; /* Dark Blue Background */
            --surface-color: #1f2937; /* Darker Surface */
            --text-color: #f3f4f6; /* Light Text */
            --text-light: #9ca3af;
            --shadow-light: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Global Reset and Typography */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Font Awesome icon styling (replacing the previous emoji-specific style) */
        .theme-icon {
            font-size: 1.2rem; /* Standard FA size */
            line-height: 1;
        }


        /* --- Utility Classes --- */
        .hidden { display: none !important; }

        /* --- LANDING PAGE STYLES --- */
        #landing-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 95vh;
        }

        .landing-container {
            width: 100%;
            max-width: 650px; 
            background-color: var(--surface-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
            border-radius: 24px;
            padding: 50px 40px;
            text-align: center;
        }
        body.dark-mode .landing-container {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
        }

        .two-line-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-weight: 900;
            display: flex;
            flex-direction: column;
            font-size: 3rem;
            line-height: 1;
        }
        .two-line-title span:first-child {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .two-line-title span:last-child {
            font-size: 1.1em;
        }

        .tagline {
            font-size: 1.15rem;
            color: var(--text-light);
            margin-bottom: 40px;
            font-weight: 400;
        }

        .theme-toggle-wrapper { margin-bottom: 30px; }

        .icon-btn-lg {
            background: var(--background-color);
            color: var(--text-color);
            border: 1px solid var(--text-light);
            border-radius: 12px;
            width: 60px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow-light);
            transition: transform 0.2s, background-color 0.2s;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .icon-btn-lg:hover {
            color: var(--primary-color);
            transform: scale(1.05) rotate(5deg);
        }

        .main-cta-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 16px 35px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0, 148, 136, 0.4);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .main-cta-btn:hover {
            background-color: #0d786d;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 148, 136, 0.6);
        }

        .feature-boxes {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 40px;
        }

        .feature-box {
            flex: 1;
            padding: 20px;
            background-color: var(--background-color);
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--secondary-color);
        }
        body.dark-mode .feature-box {
            background-color: #2a3447;
        }

        .feature-box i {
            font-size: 1.8rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .feature-box p {
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .feature-box small {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        /* --- MAIN APP LAYOUT (Second Page) --- */
        #main-app-container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--surface-color);
            border-radius: 16px;
            box-shadow: var(--shadow-light);
            min-height: 90vh;
        }

        .sidebar {
            width: 250px;
            padding: 25px;
            border-right: 1px solid #e5e7eb;
            background-color: var(--surface-color);
            border-top-left-radius: 16px;
            border-bottom-left-radius: 16px;
            display: flex;
            flex-direction: column;
        }
        body.dark-mode .sidebar { border-right-color: #374151; }

        .app-logo { color: var(--primary-color); font-size: 1.5rem; font-weight: 800; margin-bottom: 30px; }

        .main-nav { margin-bottom: 40px; }

        .nav-btn {
            display: flex; align-items: center; width: 100%; padding: 12px 15px; margin-bottom: 8px; background: none; border: none;
            color: var(--text-color); text-align: left; font-size: 1rem; font-weight: 600; border-radius: 8px; cursor: pointer;
        }

        .nav-btn i { margin-right: 10px; font-size: 1.1rem; }

        .nav-btn:hover { background-color: var(--background-color); color: var(--primary-color); }
        .nav-btn.active { background-color: var(--primary-color); color: white; box-shadow: 0 2px 10px rgba(0, 148, 136, 0.3); }
        .nav-btn.active:hover { background-color: var(--primary-color); color: white; }

        /* Color Schemes and Reset Button Styling */
        .settings-box {
            margin-top: auto; padding-top: 20px; border-top: 1px solid #e5e7eb;
        }
        body.dark-mode .settings-box { border-top-color: #374151; }

        .settings-box h4 {
            color: var(--text-color); margin-bottom: 15px; font-size: 0.9rem; font-weight: 600;
        }
        
        /* Sidebar Theme Toggle Styling (smaller icon-btn-lg) */
        .sidebar .icon-btn-lg {
            width: 40px; 
            height: 40px; 
            border-radius: 50%;
            border-color: var(--text-light);
        }

        #color-schemes-container { display: flex; gap: 10px; }

        .color-option-btn {
            width: 30px; height: 30px; border-radius: 50%; border: 3px solid transparent; cursor: pointer;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2); transition: border-color 0.2s;
        }

        .color-option-btn.active {
            border-color: var(--text-color);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        
        /* NEW Dashboard Reset Button Styling */
        #reset-data-container {
            text-align: right; /* Align button to the right, which is professional */
            margin-top: 25px; /* "a bit far from the message" */
            margin-bottom: 20px;
        }

        .dashboard-reset-btn {
            background-color: var(--expense-color); /* Red */
            color: white;
            padding: 8px 15px; /* Smaller padding */
            border: none;
            border-radius: 50px; /* Pill shape for distinction */
            cursor: pointer;
            font-size: 0.9rem; /* Smaller font size */
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .dashboard-reset-btn:hover {
            background-color: #c53030;
            transform: translateY(-1px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        

        /* Main Content Area */
        .main-content {
            flex-grow: 1; padding: 30px;
        }

        .main-content h2 {
            color: var(--text-color); font-size: 1.8rem; font-weight: 700; margin-bottom: 25px;
            border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; display: flex; align-items: center; gap: 10px;
        }
        .main-content h2 i { color: var(--primary-color); }

        /* Common Card Style */
        .card {
            background-color: var(--background-color); padding: 20px; border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 20px;
        }
        body.dark-mode .card { background-color: #2a3447; }


        /* Dashboard Grid */
        .header-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;
        }

        /* Dashboard Cards */
        .balance-card, .budget-card {
            background: var(--primary-color); 
            color: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Budget Card Layout for Edit Button */
        .budget-card h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px; 
        }
        
        #budget-edit-container {
            display: flex;
            justify-content: space-between;
            align-items: baseline; /* Align text to bottom of text */
            width: 100%;
        }
        .budget-value {
            font-size: 1.8rem;
            font-weight: 700;
            flex-grow: 1;
        }
        
        /* Enhanced Edit Button Styling */
        #edit-budget-btn {
            background-color: white; /* Simple light background */
            color: var(--primary-color);
            padding: 5px 12px;
            border-radius: 50px; /* Pill shape */
            border: none;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        body.dark-mode #edit-budget-btn {
            background-color: var(--surface-color); /* Darker surface color in dark mode */
            color: var(--primary-color);
        }
        #edit-budget-btn:hover {
            background-color: var(--secondary-color);
            color: var(--text-color);
            transform: translateY(-1px);
        }
        
        /* --- STYLING FOR SAVE CONTROLS AND BUTTON (NEW/MODIFIED) --- */
        #budget-edit-controls {
            display: flex; 
            gap: 8px;
            align-items: center;
            width: 100%; /* Take full width of parent container */
        }
        #budget-edit-controls input {
            /* Style the input to fit the pill button */
            flex-grow: 1;
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid var(--text-light);
            font-size: 0.9rem;
            height: 38px;
            color: var(--text-color);
            background-color: var(--surface-color);
        }
        
        #save-budget-btn {
            /* Pill button style, using Income color for positive action */
            background-color: var(--income-color); 
            color: white;
            padding: 5px 12px;
            border-radius: 50px; 
            border: none;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            height: 38px;
        }
        #save-budget-btn:hover {
            background-color: #0a7a5a; /* Darker income color */
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }
        /* --- END STYLING FOR SAVE CONTROLS AND BUTTON --- */


        /* Dashboard 7-Day Chart (Vertical Bar - standard) */
        #professional-chart-placeholder {
            height: 250px;
            background-color: var(--surface-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            align-items: flex-end; /* Bars start from bottom */
            border: 1px solid #ccc;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05); /* Added slight inner shadow */
        }
        body.dark-mode #professional-chart-placeholder {
            border-color: #374151;
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.05); 
        }

        /* --- CHART BAR STYLES (FIXED: Added this missing block) --- */
        .chart-bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; /* Keeps label at the bottom */
            height: 100%;
            width: 12%; /* Set bar width */
        }

        .chart-bar {
            width: 80%;
            background-color: var(--primary-color);
            border-radius: 4px 4px 0 0;
            margin-bottom: 5px;
            transition: height 0.5s ease-out;
            min-height: 2px; /* Ensure tiny expenses show up */
            position: relative;
            /* Added shadow for depth */
            box-shadow: 0 -2px 5px rgba(0, 148, 136, 0.4); 
        }
        body.dark-mode .chart-bar {
            box-shadow: 0 -2px 5px rgba(45, 212, 191, 0.4); /* Dark mode shadow using lighter primary color */
        }

        .chart-bar-group .chart-label {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 600;
        }
        /* --- END CHART BAR STYLES --- */
        
        /* Form Styles (FIXED with spacing) */
        .form-group {
            margin-bottom: 20px; 
        }
        .form-group label { 
            color: var(--text-color); 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600;
        }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem;
            background-color: var(--surface-color); color: var(--text-color);
        }
        .description-select {
            border-left: 5px solid var(--primary-color); 
        }
        .submit-btn {
            width: 100%; background-color: var(--primary-color); color: white; padding: 12px; border: none; border-radius: 8px;
            cursor: pointer; font-size: 1rem; font-weight: 600; transition: background-color 0.3s ease;
        }
        .submit-btn:hover { background-color: #0d786d; }


        /* History Table Styles (SIMPLIFIED LOOK) */
        .history-table-container { overflow-x: auto; }

        #history-table { width: 100%; border-collapse: collapse; min-width: 750px; }

        #history-table th, #history-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        body.dark-mode #history-table th, body.dark-mode #history-table td { border-bottom-color: #374151; }

        #history-table th {
            background-color: var(--background-color); 
            color: var(--text-color); 
            font-weight: 700; 
            text-transform: uppercase;
            font-size: 0.8rem; 
            letter-spacing: 0.5px;
            border-bottom: 2px solid #d1d5db;
        }
        body.dark-mode #history-table th {
            background-color: #2a3447;
            border-bottom: 2px solid #374151;
        }

        .transaction-row.income td:nth-child(2) { color: var(--income-color); font-weight: 500; }
        .transaction-row.expense td:nth-child(3) { color: var(--expense-color); font-weight: 500; }
        .transaction-row td:nth-child(4) { font-weight: 700; } 

        /* Make Edit button more apparent */
        .edit-btn, .delete-btn { 
            border: 1px solid transparent; 
            padding: 6px 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin-right: 5px; 
            transition: all 0.2s;
            font-size: 0.9rem; 
            font-weight: 600; 
            display: inline-flex;
            align-items: center;
        }
        .edit-btn { 
            color: var(--primary-color); 
            border-color: var(--primary-color);
            background-color: transparent;
        }
        .edit-btn:hover { 
            background-color: var(--primary-color); 
            color: white; 
        }
        .delete-btn { 
            color: var(--expense-color); 
            border-color: transparent; 
            background: none;
        }
        .delete-btn:hover { 
            color: white; 
            background-color: var(--expense-color); 
            border-color: var(--expense-color);
        }

        /* Alert Box for Success - Highly Visible Shape */
        .alert-box {
            padding: 15px; 
            border-radius: 8px; 
            font-weight: 600; 
            margin-top: 15px;
        }
        .alert-box.success { 
            background-color: var(--income-color); 
            color: white; 
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.6); /* Stronger shadow */
            border: 2px solid white; /* Inner border for definition */
            text-align: center; /* Center text */
            padding: 20px; /* More padding */
        }
        .alert-box.warning { 
            background-color: var(--expense-color); 
            color: white; 
        }

        /* Expense Breakdown Chart Styles */
        .report-controls { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; }
        .report-selector { display: flex; align-items: center; gap: 5px; }
        
        #breakdown-chart-placeholder {
            display: flex;
            flex-direction: column;
            gap: 15px; 
            padding: 15px;
            min-height: 200px; 
        }
        .breakdown-bar-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem; 
            color: var(--text-color);
        }
        .breakdown-label {
            width: 150px; 
            min-width: 120px;
            font-weight: 500;
            flex-shrink: 0;
        }
        .breakdown-bar-wrapper {
            flex-grow: 1;
            height: 10px; 
            background-color: #e5e7eb; 
            border-radius: 5px;
        }
        body.dark-mode .breakdown-bar-wrapper {
            background-color: #374151;
        }
        .breakdown-bar {
            height: 100%;
            background-color: var(--expense-color); 
            border-radius: 5px;
            transition: width 0.5s ease-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            width: 0%; 
        }
        .breakdown-amount {
            font-weight: 700;
            width: 90px;
            text-align: right;
            flex-shrink: 0;
            color: var(--expense-color);
        }
        .breakdown-percentage {
            font-size: 0.8rem;
            color: var(--text-light);
            width: 45px;
            text-align: right;
            flex-shrink: 0;
        }
        /* --- FOOTER --- */
        #app-footer {
            /* position: fixed; bottom: 0; left: 0; right: 0; are removed to make it static and scrollable */
            margin-top: 30px; /* Add space between the last section and the footer */
            background-color: var(--surface-color);
            border-top: 1px solid #e5e7eb; padding: 10px 20px; font-size: 0.9rem; display: flex; justify-content: center;
            gap: 20px; z-index: 10; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }
        body.dark-mode #app-footer { border-top-color: #374151; }
        #footer-balance { color: var(--primary-color); }
        #footer-spent { color: var(--expense-color); }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            #main-app-container { flex-direction: column; }
            .sidebar {
                width: 100%; border-right: none; border-bottom: 1px solid #e5e7eb;
                border-radius: 16px 16px 0 0; padding: 20px 15px;
            }
            .main-nav { display: flex; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
            .nav-btn { min-width: 120px; flex-shrink: 0; text-align: center; flex-direction: column; }
            .nav-btn i { margin-right: 0; margin-bottom: 5px; } /* Adjust icon in responsive view */
            .main-content { padding: 15px; }
            #app-footer { flex-direction: column; align-items: center; gap: 5px; padding: 10px; }
            .landing-container { max-width: 90%; padding: 30px 20px; }
            .two-line-title { font-size: 2.2rem; }
            .feature-boxes { flex-direction: column; }
            .report-controls { flex-direction: column; align-items: flex-start; }
            .report-selector { margin-left: 10px; }
        }
    </style>
</head>
<body>

    <section id="landing-section" class="page-section">
        <div class="landing-container">
            <h1 class="two-line-title">
                <span>Cumanchee</span>
                <span>Expense Tracker</span>
            </h1>
            <p class="tagline">Your simple solution for managing daily cash flow and achieving financial peace.</p>
            
            <div class="theme-toggle-wrapper">
                <button id="theme-toggle-btn-landing" class="icon-btn-lg theme-toggle-btn" title="Toggle Dark/Light Mode">
                    <i class="fas fa-moon theme-icon"></i> 
                </button>
            </div>
            
            <button id="go-to-app-btn" class="main-cta-btn">Start Tracking &rarr;</button>

            <div class="feature-boxes">
                <div class="feature-box">
                    <i class="fas fa-hand-holding-usd"></i>
                    <p>Budget Alerts</p>
                    <small>Stay under your limit.</small>
                </div>
                <div class="feature-box">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <p>Detailed Reports</p>
                    <small>Weekly & monthly insights.</small>
                </div>
                <div class="feature-box">
                    <i class="fas fa-columns"></i>
                    <p>Clear History</p>
                    <small>Four columns for clarity.</small>
                </div>
            </div>
        </div>
    </section>

    <div id="main-app-container" class="hidden">
        
        <aside class="sidebar">
            <h2 class="app-logo">Cumanchee</h2>
            <nav class="main-nav">
                <button class="nav-btn active" data-section="dashboard-section"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button class="nav-btn" data-section="add-transaction-section"><i class="fas fa-plus-circle"></i> Add Transaction</button>
                <button class="nav-btn" data-section="history-section"><i class="fas fa-history"></i> History</button>
                <button class="nav-btn" data-section="report-chart-section"><i class="fas fa-chart-bar"></i> Report Chart</button>
            </nav>
            
            <div class="settings-box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-right: 10px;">
                    <h4 id="sidebar-theme-text-container">
                        <i id="theme-text-icon" class="fas fa-moon"></i> <span id="theme-toggle-text">Dark Mode</span>
                    </h4>
                    <button id="theme-toggle-btn-sidebar" class="icon-btn-lg theme-toggle-btn" title="Toggle Dark/Light Mode">
                        <i class="fas fa-moon theme-icon"></i> 
                    </button>
                </div>
                
                <h4><i class="fas fa-palette"></i> Color Schemes</h4>
                <div id="color-schemes-container">
                    </div>
                
                </div>
        </aside>

        <main class="main-content">
            
            <section id="dashboard-section" class="app-section">
                <h2>Dashboard</h2>
                <div class="header-grid">
                    <div class="balance-card">
                        <h3>Total Balance</h3>
                        <p class="balance-display">$0.00</p>
                    </div>
                    <div class="budget-card">
                        <h3>Weekly Budget</h3>
                        <div id="budget-edit-container">
                            <span id="budget-display-amount" class="budget-value">$500.00</span>
                            <button id="edit-budget-btn"><i class="fas fa-edit"></i> Edit</button>
                            <div id="budget-edit-controls" class="hidden">
                                <input type="number" id="budget-input" value="500" min="0" step="10" placeholder="New Budget">
                                <button id="save-budget-btn"><i class="fas fa-save"></i> Save</button>
                            </div>
                            </div>
                    </div>
                </div>
                
                <div class="chart-area card">
                    <h3>Spending Overview (Last 7 Days)</h3>
                    <div id="professional-chart-placeholder">
                        </div>
                </div>
                
                <div id="alert-message" class="alert-box hidden"></div>
                
                <div id="reset-data-container">
                    <button id="reset-data-btn" class="dashboard-reset-btn">
                        <i class="fas fa-trash-alt"></i> Delete All Data
                    </button>
                </div>
                </section>

            <section id="add-transaction-section" class="app-section hidden">
                <h2><i class="fas fa-plus-circle"></i> Record Transaction</h2>
                <form id="transaction-form" class="card">
                    <div class="form-group">
                        <label for="type">Type</label>
                        <select id="type" required>
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description-select">Description</label>
                        <select id="description-select" required class="description-select">
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount ($)</label>
                        <input type="number" id="amount" required min="0.01" step="0.01" placeholder="0.00">
                    </div>
                    <button type="submit" class="submit-btn">Record Transaction</button>
                </form>
            </section>

            <section id="history-section" class="app-section hidden">
                <h2><i class="fas fa-history"></i> Transaction History</h2>
                
                <div class="report-controls card">
                    <label for="breakdown-period">Filter By Period:</label>
                    <select id="breakdown-period">
                        <option value="all">All Time</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    
                    <label for="transaction-type-filter">Filter By Type:</label>
                    <select id="transaction-type-filter">
                        <option value="all">All Transactions</option>
                        <option value="expense">Only Expenses</option>
                        <option value="income">Only Income</option>
                    </select>
                    <div id="weekly-selector" class="report-selector hidden">
                        <label for="week-select">Select Week:</label>
                        <select id="week-select"></select>
                    </div>
                    
                    <div id="monthly-selector" class="report-selector hidden">
                        <label for="month-select">Select Month:</label>
                        <select id="month-select"></select>
                    </div>
                </div>
                
                <div class="card history-table-container">
                    <table id="history-table">
                        <thead>
                            <tr>
                                <th>Date and Time</th>
                                <th>Income and Description</th>
                                <th>Expense and Description</th>
                                <th>Cash Remaining Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-list">
                            </tbody>
                    </table>
                    <p id="empty-history-msg" class="empty-message">No transactions recorded yet.</p>
                </div>
            </section>

            <section id="report-chart-section" class="app-section hidden">
                <h2><i class="fas fa-chart-bar"></i> Expense Breakdown by Category</h2>
                <div class="card">
                    <div id="breakdown-chart-placeholder" class="chart-report-placeholder">
                        <p class="empty-message">Add a transaction or adjust the period filter in the History section to view the breakdown chart here.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer id="app-footer" class="hidden">
        <span id="footer-period-info">Period: Week 1</span> | 
        <span>Total Spent: <b id="footer-spent">$0.00</b></span> | 
        <span>Budget: <b id="footer-budget">$0.00</b></span> | 
        <span>Balance: <b id="footer-balance">$0.00</b></span>
    </footer>

    <script>
        // --- STATE MANAGEMENT ---
        let transactions = [];
        let totalSpent = 0;
        let totalIncome = 0;
        let currentBalance = 0;
        let weeklyBudget = 500;
        let currentTheme = 'light';
        let currentAccentColor = '#0d9488'; 
        // MODIFIED: Added 'type' to filter object
        let currentFilter = { period: 'all', value: null, type: 'all' }; 

        const COLOR_OPTIONS = {
            'Teal': '#0d9488',
            'Blue': '#2563eb',
            'Purple': '#7c3aed',
            'Orange': '#f97316'
        };

        const COMMON_DESCRIPTIONS = {
            expense: [
                'Groceries',
                'Rent/Mortgage',
                'Transportation (Gas/Transit)',
                'Eating Out',
                'Utilities (Electric/Water)',
                'Entertainment (Subscriptions)',
                'Shopping/Apparel',
                'Health/Medical',
                'Other Expense'
            ],
            income: [
                'Salary',
                'Freelance Project',
                'Bonus',
                'Investment Dividends',
                'Gift',
                'Other Income'
            ]
        };

        // --- DOM ELEMENTS ---
        const appRoot = document.body;
        const landingSection = document.getElementById('landing-section');
        const mainAppContainer = document.getElementById('main-app-container');
        const goToAppBtn = document.getElementById('go-to-app-btn');
        
        // Use class selector to target all theme icons
        const themeToggleBtns = document.querySelectorAll('.theme-toggle-btn');
        // MODIFIED: This now selects the <i> elements
        const themeIcons = document.querySelectorAll('.theme-icon'); 
        
        // NEW: Elements for dynamic text/icon in sidebar
        const themeToggleText = document.getElementById('theme-toggle-text');
        // MODIFIED: This now selects the <i> element
        const themeTextIcon = document.getElementById('theme-text-icon'); 
        
        const navButtons = document.querySelectorAll('.nav-btn');
        const transactionForm = document.getElementById('transaction-form');
        const transactionTypeSelect = document.getElementById('type');
        const descriptionSelect = document.getElementById('description-select'); 
        const transactionList = document.getElementById('transaction-list');
        const emptyHistoryMsg = document.getElementById('empty-history-msg');
        const colorSchemesContainer = document.getElementById('color-schemes-container');
        const alertMessage = document.getElementById('alert-message');
        const chartPlaceholder = document.getElementById('professional-chart-placeholder'); 
        const budgetDisplayAmount = document.getElementById('budget-display-amount');
        const editBudgetBtn = document.getElementById('edit-budget-btn');
        const saveBudgetBtn = document.getElementById('save-budget-btn');
        const budgetInput = document.getElementById('budget-input');
        const budgetEditControls = document.getElementById('budget-edit-controls');
        const footerSpent = document.getElementById('footer-spent');
        const footerBudget = document.getElementById('footer-budget');
        const footerBalance = document.getElementById('footer-balance');
        const footerPeriodInfo = document.getElementById('footer-period-info');

        const breakdownPeriodSelect = document.getElementById('breakdown-period');
        // NEW: Transaction Type Filter
        const transactionTypeFilter = document.getElementById('transaction-type-filter');
        const weeklySelector = document.getElementById('weekly-selector');
        const monthlySelector = document.getElementById('monthly-selector');
        const weekSelect = document.getElementById('week-select');
        const monthSelect = document.getElementById('month-select');
        const breakdownChartPlaceholder = document.getElementById('breakdown-chart-placeholder');
        
        // Button is now in the dashboard section
        const resetDataBtn = document.getElementById('reset-data-btn');


        // --- LOCAL STORAGE FUNCTIONS ---
        function loadState() {
            const savedTransactions = localStorage.getItem('cumancheeTransactions');
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions).map(t => ({
                    ...t,
                    // Ensure amount is float and formatted for internal consistency
                    amount: parseFloat(t.amount).toFixed(2)
                })); 
            } else {
                // NEW: Initial data for October and November 2025 (fixed year 2025)
                transactions = [
                    // October 2025 Transactions
                    { id: 1664582400000, type: 'income', description: 'Salary', amount: '3500.00', date: '2025-10-31T09:00:00.000Z' },
                    { id: 1664582400001, type: 'expense', description: 'Rent/Mortgage', amount: '1200.00', date: '2025-10-01T10:00:00.000Z' },
                    { id: 1664582400002, type: 'expense', description: 'Groceries', amount: '85.50', date: '2025-10-05T12:00:00.000Z' },
                    { id: 1664582400003, type: 'expense', description: 'Eating Out', amount: '32.75', date: '2025-10-08T18:30:00.000Z' },
                    { id: 1664582400004, type: 'income', description: 'Freelance Project', amount: '500.00', date: '2025-10-15T14:00:00.000Z' },
                    { id: 1664582400005, type: 'expense', description: 'Transportation (Gas/Transit)', amount: '60.00', date: '2025-10-20T11:00:00.000Z' },
                    { id: 1664582400006, type: 'expense', description: 'Entertainment (Subscriptions)', amount: '15.00', date: '2025-10-25T17:00:00.000Z' },
                    
                    // November 2025 Transactions
                    { id: 1664582400007, type: 'expense', description: 'Groceries', amount: '110.20', date: '2025-11-01T11:00:00.000Z' },
                    { id: 1664582400008, type: 'expense', description: 'Shopping/Apparel', amount: '210.00', date: '2025-11-03T16:00:00.000Z' },
                    { id: 1664582400009, type: 'income', description: 'Bonus', amount: '250.00', date: '2025-11-04T08:00:00.000Z' }
                ].map(t => ({
                    ...t,
                    amount: parseFloat(t.amount).toFixed(2)
                }));
            }
            const savedBudget = localStorage.getItem('cumancheeWeeklyBudget');
            if (savedBudget) {
                weeklyBudget = parseFloat(savedBudget);
            }
            const savedTheme = localStorage.getItem('cumancheeTheme');
            if (savedTheme) {
                currentTheme = savedTheme;
            }
            const savedColor = localStorage.getItem('cumancheeAccentColor');
            if (savedColor) {
                currentAccentColor = savedColor;
                applyAccentColor(currentAccentColor);
            }
        }

        function saveTransactions() {
            localStorage.setItem('cumancheeTransactions', JSON.stringify(transactions));
        }

        function saveBudget() {
            localStorage.setItem('cumancheeWeeklyBudget', weeklyBudget);
        }

        // --- RESET DATA FUNCTION ---
        function resetAllData() {
            if (confirm('WARNING: This will erase ALL your transactions, budget, and history permanently. Are you absolutely sure?')) {
                // 1. Clear Local Storage
                localStorage.removeItem('cumancheeTransactions');
                localStorage.removeItem('cumancheeWeeklyBudget');

                // 2. Reset in-memory state variables to initial, empty values
                transactions = []; 
                weeklyBudget = 500;
                
                // 3. Update the UI based on the new, empty state
                // Removed loadState() to prevent re-insertion of sample data.
                updateBalances(); 
                
                // 4. Switch to the History section to display the result message
                switchSection('history-section'); 
                
                alert('All data has been successfully reset.');
            }
        }
        // --- END RESET DATA FUNCTION ---


        // --- THEME AND COLOR LOGIC ---
        function applyTheme(theme) {
            if (theme === 'dark') {
                appRoot.classList.add('dark-mode');
                
                // MODIFIED: Set icon to SUN icon (for switching to light mode)
                themeIcons.forEach(icon => {
                    icon.className = 'fas fa-sun theme-icon'; 
                });
                
                // MODIFIED: Text/Icon for Light Mode
                if (themeToggleText && themeTextIcon) {
                    themeToggleText.textContent = 'Light Mode';
                    themeTextIcon.className = 'fas fa-sun';
                }
                
                currentTheme = 'dark';
            } else {
                appRoot.classList.remove('dark-mode');
                
                // MODIFIED: Set icon to MOON icon (for switching to dark mode)
                themeIcons.forEach(icon => {
                    icon.className = 'fas fa-moon theme-icon'; 
                });

                // MODIFIED: Text/Icon for Dark Mode 
                if (themeToggleText && themeTextIcon) {
                    themeToggleText.textContent = 'Dark Mode';
                    themeTextIcon.className = 'fas fa-moon';
                }
                
                currentTheme = 'light';
            }
            localStorage.setItem('cumancheeTheme', currentTheme);
        }


        function applyAccentColor(colorCode) {
            appRoot.style.setProperty('--primary-color', colorCode);
            currentAccentColor = colorCode;
            localStorage.setItem('cumancheeAccentColor', colorCode);
            
            document.querySelectorAll('.color-option-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.style.backgroundColor === colorCode) {
                    btn.classList.add('active');
                }
            });
        }

        function createColorOptions() {
            for (const name in COLOR_OPTIONS) {
                const colorCode = COLOR_OPTIONS[name];
                const button = document.createElement('button');
                button.classList.add('color-option-btn');
                button.title = name;
                button.style.backgroundColor = colorCode;
                
                if (colorCode === currentAccentColor) {
                    button.classList.add('active');
                }

                button.addEventListener('click', () => applyAccentColor(colorCode));
                colorSchemesContainer.appendChild(button);
            }
        }


        // --- NAVIGATION LOGIC ---
        function switchSection(targetSectionId) {
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.add('hidden');
            });

            const targetSection = document.getElementById(targetSectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            navButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-section') === targetSectionId) {
                    btn.classList.add('active');
                }
            });
            
            if (targetSectionId === 'report-chart-section') {
                renderExpenseBreakdownChart();
            }
        }

        // --- CORE APP LOGIC ---

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        // --- FILTER AND REPORTING LOGIC ---

        function isTransactionInCurrentFilter(t) {
            
            // 1. Filter by Type (NEW)
            if (currentFilter.type !== 'all' && t.type !== currentFilter.type) {
                return false;
            }
            
            // 2. Filter by Period (Existing Logic)
            if (currentFilter.period === 'all') return true;
            if (!currentFilter.value) return false;

            const date = new Date(t.date);

            if (currentFilter.period === 'weekly') {
                const yearWeek = `${date.getFullYear()}-${getWeekNumber(date)}`;
                return yearWeek === currentFilter.value;
            }

            if (currentFilter.period === 'monthly') {
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return yearMonth === currentFilter.value;
            }
            return false;
        }
        
        function populatePeriodSelectors() {
            const weeks = new Set();
            const months = new Set();

            transactions.forEach(t => {
                const date = new Date(t.date);
                if (isNaN(date)) return; 
                
                const yearWeek = `${date.getFullYear()}-${getWeekNumber(date)}`;
                weeks.add(yearWeek);
                
                const monthName = date.toLocaleString('default', { year: 'numeric', month: 'long' });
                const monthValue = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                months.add({ value: monthValue, name: monthName });
            });

            // Populate Weeks
            weekSelect.innerHTML = '';
            [...weeks].sort().reverse().forEach(w => {
                const option = document.createElement('option');
                option.value = w;
                option.textContent = `Week ${w.split('-')[1]} (${w.split('-')[0]})`;
                weekSelect.appendChild(option);
            });
            if (weekSelect.options.length === 0) { weekSelect.innerHTML = '<option value="">No Weeks</option>'; }

            // Populate Months
            monthSelect.innerHTML = '';
            [...months].sort((a, b) => b.value.localeCompare(a.value)).forEach(m => {
                const option = document.createElement('option');
                option.value = m.value;
                option.textContent = m.name;
                monthSelect.appendChild(option);
            });
            if (monthSelect.options.length === 0) { monthSelect.innerHTML = '<option value="">No Months</option>'; }
        }
        
        function getExpenseBreakdown() {
            const breakdownMap = {};
            let totalExpense = 0;
            
            // Filter by expense type and current period/type filter
            transactions.filter(t => t.type === 'expense' && isTransactionInCurrentFilter(t)).forEach(t => {
                const amount = parseFloat(t.amount);
                const desc = t.description;
                breakdownMap[desc] = (breakdownMap[desc] || 0) + amount;
                totalExpense += amount;
            });

            const breakdownArray = Object.keys(breakdownMap).map(desc => ({
                description: desc,
                amount: breakdownMap[desc]
            })).sort((a, b) => b.amount - a.amount);

            return { totalExpense, breakdown: breakdownArray };
        }

        // UPDATED FOR PROFESSIONAL CHART LOOK
        function renderExpenseBreakdownChart() {
            const { totalExpense, breakdown } = getExpenseBreakdown();
            
            breakdownChartPlaceholder.innerHTML = '';

            // NEW: Special check for income filter
            if (currentFilter.type === 'income') {
                 breakdownChartPlaceholder.innerHTML = '<p class="empty-message">Expense breakdown is not available when filtering for only Income transactions.</p>';
                 return;
            }

            if (totalExpense === 0) {
                breakdownChartPlaceholder.innerHTML = '<p class="empty-message">No expenses recorded for the current filter period.</p>';
                return;
            }

            breakdown.forEach(item => {
                const percentage = (item.amount / totalExpense) * 100;
                
                const barContainer = document.createElement('div');
                barContainer.classList.add('breakdown-bar-container');
                
                const label = document.createElement('div');
                label.classList.add('breakdown-label');
                label.textContent = item.description;

                const barWrapper = document.createElement('div');
                barWrapper.classList.add('breakdown-bar-wrapper');

                const bar = document.createElement('div');
                bar.classList.add('breakdown-bar');

                const amountDisplay = document.createElement('div');
                amountDisplay.classList.add('breakdown-amount');
                amountDisplay.textContent = `$${item.amount.toFixed(2)}`;
                
                const percentageDisplay = document.createElement('div');
                percentageDisplay.classList.add('breakdown-percentage');
                percentageDisplay.textContent = `${percentage.toFixed(0)}%`;


                // Append elements
                barWrapper.appendChild(bar);
                barContainer.appendChild(label);
                barContainer.appendChild(barWrapper);
                barContainer.appendChild(percentageDisplay);
                barContainer.appendChild(amountDisplay);
                breakdownChartPlaceholder.appendChild(barContainer);

                // Animate the bar width
                setTimeout(() => {
                    bar.style.width = `${Math.max(1, percentage)}%`; 
                }, 100); 
            });
        }
        
        function updateFiltersAndRender() {
            const period = breakdownPeriodSelect.value;
            const type = transactionTypeFilter.value; // NEW: Get type filter
            
            currentFilter.period = period;
            currentFilter.type = type; // NEW: Set type filter
            currentFilter.value = null;

            weeklySelector.classList.add('hidden');
            monthlySelector.classList.add('hidden');

            if (period === 'weekly') {
                weeklySelector.classList.remove('hidden');
                currentFilter.value = weekSelect.value;
            } else if (period === 'monthly') {
                monthlySelector.classList.remove('hidden');
                currentFilter.value = monthSelect.value;
            }

            renderHistory();
            renderExpenseBreakdownChart();
        }

        // --- DASHBOARD CHART LOGIC (Kept as is) ---

        function getDailyExpenses() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const daySequence = [];
            const names = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - (6 - i)); 
                const checkDateString = checkDate.toISOString().split('T')[0];
                
                const dayIndex = checkDate.getDay(); 
                const dayName = names[(dayIndex + 6) % 7]; 

                let expense = 0;
                
                transactions.filter(t => t.type === 'expense').forEach(t => {
                    const tDate = new Date(t.date);
                    tDate.setHours(0, 0, 0, 0);
                    const tDateString = tDate.toISOString().split('T')[0];
                    
                    if (tDateString === checkDateString) {
                        expense += parseFloat(t.amount);
                    }
                });

                daySequence.push({ dayName, expense });
            }
            
            return daySequence;
        }

        function renderChart() {
            const dailyExpenses = getDailyExpenses();
            const maxExpense = Math.max(...dailyExpenses.map(d => d.expense));
            
            chartPlaceholder.innerHTML = ''; 

            dailyExpenses.forEach(dayData => {
                const barGroup = document.createElement('div');
                barGroup.classList.add('chart-bar-group');

                const label = document.createElement('div');
                label.classList.add('chart-label');
                label.textContent = dayData.dayName;

                const bar = document.createElement('div');
                bar.classList.add('chart-bar');
                
                let heightPercent = 0;
                if (dayData.expense > 0) {
                    // Ensure the bar is visible even for very small expenses (min 2%)
                    heightPercent = Math.max(2, (dayData.expense / (maxExpense || 1)) * 100);
                }

                bar.title = `$${dayData.expense.toFixed(2)} spent on ${dayData.dayName}`;
                
                bar.style.height = '0%'; // Initial height set to 0 for animation
                barGroup.appendChild(bar); 
                barGroup.appendChild(label);
                chartPlaceholder.appendChild(barGroup);
                
                // Animate the bar height
                setTimeout(() => {
                    bar.style.height = `${heightPercent}%`;
                }, 100); 
            });
        }

        function checkBudgetAlerts() {
            const currentWeek = getWeekNumber(new Date());
            const currentWeekSpent = transactions
                .filter(t => t.type === 'expense' && getWeekNumber(new Date(t.date)) === currentWeek)
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);

            alertMessage.classList.add('hidden');
            alertMessage.textContent = '';
            alertMessage.classList.remove('warning', 'success');

            if (weeklyBudget === 0) return; 

            if (currentWeekSpent > weeklyBudget) {
                alertMessage.classList.remove('hidden');
                alertMessage.classList.add('warning');
                // MODIFIED: Replaced literal ** with <strong> tags
                alertMessage.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <strong>Warning!</strong> You have exceeded your weekly budget of <strong>$${weeklyBudget.toFixed(2)}</strong>! Spent: <strong>$${currentWeekSpent.toFixed(2)}</strong>.`;
            } else if (currentWeekSpent > weeklyBudget * 0.8) {
                 alertMessage.classList.remove('hidden');
                 alertMessage.classList.add('warning');
                 // MODIFIED: Replaced literal ** with <strong> tags
                 alertMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> <strong>Alert!</strong> You are approaching your budget limit. Keep tracking! (${(100 * currentWeekSpent / weeklyBudget).toFixed(0)}% used)`;
            } else if (currentWeekSpent < weeklyBudget / 2) {
                 alertMessage.classList.remove('hidden');
                 alertMessage.classList.add('success');
                 // MODIFIED: Replaced literal ** with <strong> tags
                 alertMessage.innerHTML = `<i class="fas fa-check-circle"></i> <strong>Great job!</strong> You are well under your budget this week.`;
            }
        }

        function updateDescriptionOptions(type) {
            descriptionSelect.innerHTML = '';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `--- Select ${type === 'expense' ? 'Expense' : 'Income'} Category ---`;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            descriptionSelect.appendChild(defaultOption);

            COMMON_DESCRIPTIONS[type].forEach(desc => {
                const option = document.createElement('option');
                option.value = desc;
                option.textContent = desc;
                descriptionSelect.appendChild(option);
            });
        }

        function updateBalances() {
            totalIncome = 0;
            totalSpent = 0;

            transactions.forEach(t => {
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    totalIncome += amount;
                } else {
                    totalSpent += amount;
                }
            });
            
            currentBalance = totalIncome - totalSpent;

            document.querySelector('.balance-display').textContent = `$${currentBalance.toFixed(2)}`;
            budgetDisplayAmount.textContent = `$${weeklyBudget.toFixed(2)}`;
            budgetInput.value = weeklyBudget;

            document.getElementById('app-footer').classList.remove('hidden');
            footerSpent.textContent = `$${totalSpent.toFixed(2)}`;
            footerBudget.textContent = `$${weeklyBudget.toFixed(2)}`;
            footerBalance.textContent = `$${currentBalance.toFixed(2)}`;
            footerPeriodInfo.textContent = `Period: Week ${getWeekNumber(new Date())}`; 

            checkBudgetAlerts();
            populatePeriodSelectors(); 
            updateFiltersAndRender(); 
            renderChart(); 
        }

        function renderHistory() {
            transactionList.innerHTML = '';
            
            if (transactions.length === 0) {
                emptyHistoryMsg.classList.remove('hidden');
                emptyHistoryMsg.textContent = 'No transactions recorded yet.'; // Ensure the default message is set
                return;
            }
            emptyHistoryMsg.classList.add('hidden');

            let runningBalance = 0;
            const sortedTransactions = transactions.slice().sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Calculate running balance based on ALL transactions
            const transactionsWithRunningBalance = sortedTransactions.map(t => {
                const amount = parseFloat(t.amount);
                if (t.type === 'income') {
                    runningBalance += amount;
                } else {
                    runningBalance -= amount;
                }
                return { ...t, runningBalance: runningBalance.toFixed(2) };
            });

            // Render only transactions that match the current filter
            const filteredTransactions = transactionsWithRunningBalance.filter(isTransactionInCurrentFilter).reverse();
            
            if (filteredTransactions.length === 0) {
                 emptyHistoryMsg.classList.remove('hidden');
                 emptyHistoryMsg.textContent = 'No transactions match the current filter criteria.';
                 return;
            } else {
                 emptyHistoryMsg.classList.add('hidden');
            }


            filteredTransactions.forEach(t => {
                const row = document.createElement('tr');
                row.classList.add('transaction-row', t.type);
                row.dataset.id = t.id;

                const dateTime = new Date(t.date).toLocaleString();
                const amount = parseFloat(t.amount).toFixed(2);

                row.innerHTML = `
                    <td>${dateTime}</td>
                    <td class="${t.type === 'income' ? 'income' : ''}">
                        ${t.type === 'income' ? `$${amount} <br> ${t.description}` : ''}
                    </td>
                    <td class="${t.type === 'expense' ? 'expense' : ''}">
                        ${t.type === 'expense' ? `$${amount} <br> ${t.description}` : ''}
                    </td>
                    <td>$${t.runningBalance}</td>
                    <td>
                        <button class="edit-btn" data-id="${t.id}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="delete-btn" data-id="${t.id}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                transactionList.appendChild(row); 
            });
        }

        function addTransaction(type, description, amount) {
            const newTransaction = {
                id: Date.now(), 
                type: type,
                description: description,
                amount: parseFloat(amount).toFixed(2),
                date: new Date().toISOString()
            };
            transactions.push(newTransaction);
            saveTransactions();
            updateBalances();
        }

        function editTransaction(id, newType, newDescription, newAmount) {
            const index = transactions.findIndex(t => t.id == id);
            if (index !== -1) {
                transactions[index] = {
                    ...transactions[index],
                    type: newType,
                    description: newDescription,
                    amount: parseFloat(newAmount).toFixed(2)
                };
                saveTransactions();
                updateBalances();
            }
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id != id);
            saveTransactions();
            updateBalances();
        }

        // --- EVENT LISTENERS ---

        // Reset Button Listener
        resetDataBtn.addEventListener('click', resetAllData);
        
        // Landing Page Nav
        goToAppBtn.addEventListener('click', () => {
            landingSection.classList.add('hidden');
            mainAppContainer.classList.remove('hidden');
            document.getElementById('app-footer').classList.remove('hidden');
            switchSection('dashboard-section');
        });

        // Theme Toggle (Targets all buttons with the class)
        themeToggleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                applyTheme(currentTheme === 'light' ? 'dark' : 'light');
            });
        });

        // Main App Navigation
        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetSectionId = btn.getAttribute('data-section');
                switchSection(targetSectionId);
            });
        });

        // Update Description Dropdown on Type Change
        transactionTypeSelect.addEventListener('change', (e) => {
            updateDescriptionOptions(e.target.value);
        });

        // Filter Dropdown Listeners
        breakdownPeriodSelect.addEventListener('change', updateFiltersAndRender);
        // NEW: Listener for Transaction Type Filter
        transactionTypeFilter.addEventListener('change', updateFiltersAndRender); 
        weekSelect.addEventListener('change', updateFiltersAndRender);
        monthSelect.addEventListener('change', updateFiltersAndRender);


        // Transaction Form Submission
        transactionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const type = transactionTypeSelect.value;
            const description = descriptionSelect.value; 
            const amount = document.getElementById('amount').value;

            if (!description || description === '') {
                alert('Please select a valid description.');
                return;
            }

            addTransaction(type, description, amount);
            transactionForm.reset();
            updateDescriptionOptions(type); 
            switchSection('history-section'); 
        });

        // Budget Setting (Inline UI)
        editBudgetBtn.addEventListener('click', () => {
            budgetDisplayAmount.classList.add('hidden');
            editBudgetBtn.classList.add('hidden');
            budgetEditControls.classList.remove('hidden');
            budgetInput.focus();
        });

        saveBudgetBtn.addEventListener('click', () => {
            const newBudget = parseFloat(budgetInput.value);
            if (newBudget >= 0) {
                weeklyBudget = newBudget;
                saveBudget();
                updateBalances();
            } else {
                alertMessage.classList.remove('hidden');
                alertMessage.classList.add('warning');
                alertMessage.innerHTML = `<i class="fas fa-times-circle"></i> Invalid budget amount entered.`;
            }

            budgetDisplayAmount.classList.remove('hidden');
            editBudgetBtn.classList.remove('hidden');
            budgetEditControls.classList.add('hidden');
        });


        // Edit/Delete Handlers
        transactionList.addEventListener('click', (e) => {
            const target = e.target.closest('button');
            if (!target) return;

            const id = target.dataset.id;
            if (target.classList.contains('delete-btn')) {
                if(confirm('Are you sure you want to delete this transaction?')) {
                    deleteTransaction(id);
                }
            } else if (target.classList.contains('edit-btn')) {
                const transaction = transactions.find(t => t.id == id);
                if (transaction) {
                    const newDesc = prompt('Edit Description:', transaction.description);
                    const newAmount = prompt('Edit Amount:', transaction.amount);
                    
                    if (newDesc === null || newAmount === null) {
                        return; 
                    }

                    const newType = confirm(`Is this an INCOME transaction? (Click OK for Income, Cancel for Expense)`) ? 'income' : 'expense';

                    if (parseFloat(newAmount) > 0) {
                        editTransaction(id, newType, newDesc, newAmount);
                    } else {
                        console.log('Edit canceled or invalid amount entered.');
                    }
                }
            }
        });


        // --- INITIALIZATION ---
        function initializeApp() {
            loadState();
            applyTheme(currentTheme); // Apply theme immediately on load, setting the correct icon
            createColorOptions();
            updateDescriptionOptions('expense'); 
            updateBalances(); 
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            
            mainAppContainer.classList.add('hidden');
            document.getElementById('app-footer').classList.add('hidden');
            landingSection.classList.remove('hidden');
        });
    </script> 
</body>

</html>